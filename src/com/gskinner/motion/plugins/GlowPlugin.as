/*** GlowPlugin by Pierre-Yves Gatouillat. Oct 10, 2010* Based on the BlurPlugin class by Grant Skinner.*** Copyright (c) 2009 Grant Skinner* * Permission is hereby granted, free of charge, to any person* obtaining a copy of this software and associated documentation* files (the "Software"), to deal in the Software without* restriction, including without limitation the rights to use,* copy, modify, merge, publish, distribute, sublicense, and/or sell* copies of the Software, and to permit persons to whom the* Software is furnished to do so, subject to the following* conditions:* * The above copyright notice and this permission notice shall be* included in all copies or substantial portions of the Software.* * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND,* EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES* OF MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND* NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT* HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY,* WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING* FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR* OTHER DEALINGS IN THE SOFTWARE.**/package com.gskinner.motion.plugins {		import com.gskinner.motion.GTween;	import flash.filters.GlowFilter;	import com.gskinner.motion.plugins.IGTweenPlugin;		/**	* Plugin for GTween. Applies a glow filter to the target based on the "blur", "blurX", and/or "blurY",	* as well as "alpha", "color", and/or "strength" tween values.	* <br/><br/>	* If a glow filter does not already exist on the tween target, the plugin will create one.	* Note that this may conflict with other plugins that use filters. If you experience problems,	* try applying a glow filter to the target in advance to avoid this behaviour.	* <br/><br/>	* Supports the following <code>pluginData</code> properties:<UL>	* <LI> GlowEnabled: overrides the enabled property for the plugin on a per tween basis.	* <LI> GlowData: Used internally.	* </UL>	**/	public class GlowPlugin implements IGTweenPlugin {			// Static interface:		/** Specifies whether this plugin is enabled for all tweens by default. **/		public static var enabled:Boolean=true;				/** @private **/		protected static var instance:GlowPlugin;		/** @private **/		protected static var tweenProperties:Array = ["glowBlurX","glowBlurY","glowBlur","glowAlpha","glowColor","glowStrength"];				/**		* Installs this plugin for use with all GTween instances.		**/		public static function install():void {			if (instance) { return; }			instance = new GlowPlugin();			GTween.installPlugin(instance,tweenProperties);		}			// Public methods:		/** @private **/		public function init(tween:GTween, name:String, value:Number):Number {			if (!((tween.pluginData.GlowEnabled == null && enabled) || tween.pluginData.GlowEnabled)) { return value; }						// try to find a blur filter:			var f:Array = tween.target.filters;			for (var i:uint=0; i<f.length; i++) {				if (f[i] is GlowFilter) {					// found one.					var glowF:GlowFilter = f[i];										// save off its index for future reference:					tween.pluginData.GlowData = {index:i}										// return our initial values from it:					if (name == "glowAlpha") {						return glowF.alpha;					} else if (name == "glowColor") {						return glowF.color;					} else if (name == "glowStrength") {						return glowF.strength;					} else if (name == "glowBlurX") {						return glowF.blurX;					} else if (name == "glowBlurY") {						return glowF.blurY;					} else if (name == "glowBlur") {						return (glowF.blurX+glowF.blurY)/2;					} else {						return glowF[name];					}				}			}			// didn't find one, so our glow starts at 0:			return 0;		}				/** @private **/		public function tween(tween:GTween, name:String, value:Number, initValue:Number, rangeValue:Number, ratio:Number, end:Boolean):Number {			// don't run if we're not enabled:			if (!((tween.pluginData.GlowEnabled == null && enabled) || tween.pluginData.GlowEnabled)) { return value; }						// grab the tween specific data from pluginData:			var data:Object = tween.pluginData.GlowData;			if (data == null) { data = initTarget(tween); }						// grab the filter:			var f:Array = tween.target.filters;			var glowF:GlowFilter = f[data.index] as GlowFilter;			if (glowF == null) { return value; }						// update the filter and set it back to the target:			if (name == "glowAlpha") { glowF.alpha = value; }			else if (name == "glowColor") { glowF.color = value; }			else if (name == "glowStrength") { glowF.strength = value; }			else if (name == "glowBlurX") { glowF.blurX = value; }			else if (name == "glowBlurY") { glowF.blurY = value; }			else if (name == "glowBlur") { glowF.blurX = glowF.blurY = value; }			else { glowF[name] = value; }			tween.target.filters = f;						// clean up if it's the end of the tween:			if (end) {				delete(tween.pluginData.GlowData);			}						// tell GTween not to use the default assignment behaviour:			return NaN;		}			// Private methods:		/** @private **/		protected function initTarget(tween:GTween):Object {			var f:Array = tween.target.filters;			f.push(new GlowFilter(0,0,0,0,0,1));			tween.target.filters = f;			return tween.pluginData.GlowData = {index:f.length-1};		}			}}